# Inventory Service - å®Œæ•´å¯¦ç¾å ±å‘Š

## ğŸ¯ é …ç›®æ¦‚è¿°

**Inventory Service (åº«å­˜æœå‹™)** æ˜¯é›»å•†å¹³å°çš„æ ¸å¿ƒå¾®æœå‹™ä¹‹ä¸€ï¼Œè² è²¬ç®¡ç†å•†å“åº«å­˜ã€è™•ç†åº«å­˜é ç•™ã€é‡‹æ”¾å’Œç¢ºèªæ“ä½œï¼Œä¸¦æä¾›é«˜ä½µç™¼å ´æ™¯ä¸‹çš„é˜²è¶…è³£æ©Ÿåˆ¶ã€‚

## âœ… å®ŒæˆåŠŸèƒ½æ¸…å–®

### ğŸ“Š æ ¸å¿ƒåŠŸèƒ½

- [x] **åº«å­˜ç®¡ç†**
  - [x] å‰µå»º/æ›´æ–°å•†å“åº«å­˜
  - [x] æŸ¥è©¢åº«å­˜ä¿¡æ¯
  - [x] æ‰¹é‡æŸ¥è©¢åº«å­˜
  - [x] åº«å­˜ä¸è¶³å•†å“æŸ¥è©¢

- [x] **åº«å­˜æ“ä½œ**
  - [x] åº«å­˜é ç•™ï¼ˆè¨‚å–®å‰µå»ºæ™‚ï¼‰
  - [x] åº«å­˜é‡‹æ”¾ï¼ˆè¨‚å–®å–æ¶ˆæ™‚ï¼‰
  - [x] åº«å­˜ç¢ºèªï¼ˆè¨‚å–®ä»˜æ¬¾æ™‚ï¼‰
  - [x] åº«å­˜è£œå……ï¼ˆå•†å“å…¥åº«æ™‚ï¼‰

- [x] **é˜²è¶…è³£æ©Ÿåˆ¶**
  - [x] Redis åˆ†æ•£å¼é–
  - [x] æ¨‚è§€é–ç‰ˆæœ¬æ§åˆ¶
  - [x] æ•¸æ“šåº«ç´„æŸæª¢æŸ¥
  - [x] åŸå­æ“ä½œä¿è­‰

### ğŸ—ï¸ æŠ€è¡“æ¶æ§‹

- [x] **å¾®æœå‹™æ¶æ§‹**
  - [x] Spring Boot 3.1
  - [x] Spring Cloud 2022.0
  - [x] Eureka æœå‹™è¨»å†Šç™¼ç¾
  - [x] Spring Cloud Config é…ç½®ä¸­å¿ƒ

- [x] **æ•¸æ“šæŒä¹…åŒ–**
  - [x] PostgreSQL æ•¸æ“šåº«
  - [x] Spring Data JPA
  - [x] Flyway æ•¸æ“šåº«é·ç§»
  - [x] æ¨‚è§€é–ç‰ˆæœ¬æ§åˆ¶

- [x] **ç·©å­˜èˆ‡é–**
  - [x] Redis ç·©å­˜
  - [x] Redisson åˆ†æ•£å¼é–
  - [x] å¯é…ç½®é–è¶…æ™‚æ™‚é–“

- [x] **å®¹å™¨åŒ–éƒ¨ç½²**
  - [x] Docker å®¹å™¨
  - [x] Docker Compose ç·¨æ’
  - [x] å¥åº·æª¢æŸ¥é…ç½®

### ğŸ§ª æ¸¬è©¦è¦†è“‹

- [x] **å–®å…ƒæ¸¬è©¦**
  - [x] æ¥­å‹™é‚è¼¯æ¸¬è©¦ (InventoryServiceTest)
  - [x] å¯¦é«”é¡æ¸¬è©¦ (InventoryTest)
  - [x] Mock ä¾è³´æ¸¬è©¦

- [x] **é›†æˆæ¸¬è©¦**
  - [x] REST API æ¸¬è©¦
  - [x] æ•¸æ“šåº«é›†æˆæ¸¬è©¦
  - [x] TestContainers ç’°å¢ƒ

- [x] **ä½µç™¼æ¸¬è©¦**
  - [x] é«˜ä½µç™¼åº«å­˜é ç•™æ¸¬è©¦
  - [x] é˜²è¶…è³£æ©Ÿåˆ¶é©—è­‰
  - [x] æ•¸æ“šä¸€è‡´æ€§æ¸¬è©¦
  - [x] åˆ†æ•£å¼é–æ€§èƒ½æ¸¬è©¦

- [x] **è² è¼‰æ¸¬è©¦**
  - [x] API æ€§èƒ½æ¸¬è©¦è…³æœ¬
  - [x] ä½µç™¼å£“åŠ›æ¸¬è©¦è…³æœ¬
  - [x] ç³»çµ±å®¹é‡è©•ä¼°

## ğŸš€ API ç«¯é»

| æ–¹æ³• | ç«¯é» | åŠŸèƒ½ | ç‹€æ…‹ |
|------|------|------|------|
| POST | `/api/v1/inventory` | å‰µå»º/æ›´æ–°åº«å­˜ | âœ… |
| GET | `/api/v1/inventory/{productId}` | æŸ¥è©¢åº«å­˜ | âœ… |
| GET | `/api/v1/inventory/check/{productId}` | æª¢æŸ¥åº«å­˜ | âœ… |
| POST | `/api/v1/inventory/reserve` | é ç•™åº«å­˜ | âœ… |
| POST | `/api/v1/inventory/{productId}/release` | é‡‹æ”¾åº«å­˜ | âœ… |
| POST | `/api/v1/inventory/{productId}/confirm` | ç¢ºèªåº«å­˜ | âœ… |
| POST | `/api/v1/inventory/{productId}/replenish` | è£œå……åº«å­˜ | âœ… |
| GET | `/api/v1/inventory/low-stock` | ä½åº«å­˜å•†å“ | âœ… |
| POST | `/api/v1/inventory/batch` | æ‰¹é‡æŸ¥è©¢ | âœ… |
| GET | `/api/v1/inventory/health` | å¥åº·æª¢æŸ¥ | âœ… |

## ğŸ”’ é˜²è¶…è³£æ©Ÿåˆ¶

### å¤šå±¤é˜²è­·ç­–ç•¥

1. **åˆ†æ•£å¼é–å±¤**
   - ä½¿ç”¨ Redisson å¯¦ç¾ Redis åˆ†æ•£å¼é–
   - é–è¶…æ™‚æ™‚é–“: 30ç§’
   - ç­‰å¾…æ™‚é–“: 10ç§’
   - ç¢ºä¿è·¨å¯¦ä¾‹çš„æ“ä½œä¸²è¡ŒåŒ–

2. **æ¨‚è§€é–å±¤**
   - JPA `@Version` è¨»è§£
   - æ•¸æ“šåº«å±¤é¢çš„ç‰ˆæœ¬æ§åˆ¶
   - ä½µç™¼æ›´æ–°æª¢æ¸¬å’Œå›æ»¾

3. **æ•¸æ“šåº«ç´„æŸå±¤**
   - `CHECK` ç´„æŸç¢ºä¿åº«å­˜ä¸ç‚ºè² æ•¸
   - `UNIQUE` ç´„æŸé˜²æ­¢é‡è¤‡å•†å“
   - äº‹å‹™ä¿è­‰åŸå­æ€§

### ä½µç™¼æ¸¬è©¦çµæœ

- âœ… 20å€‹ä½µç™¼è«‹æ±‚ï¼Œæ¯å€‹è«‹æ±‚10å€‹å•†å“
- âœ… åˆå§‹åº«å­˜100ï¼Œç¸½è«‹æ±‚200ï¼ˆè¶…éåº«å­˜ï¼‰
- âœ… çµæœï¼š10å€‹æˆåŠŸï¼Œ10å€‹å¤±æ•—
- âœ… æœ€çµ‚åº«å­˜ï¼šç¸½é‡100ï¼Œé ç•™100ï¼Œå¯ç”¨0
- âœ… ç„¡è¶…è³£ç¾è±¡ï¼Œæ•¸æ“šä¸€è‡´æ€§å®Œç¾

## ğŸ“Š æ•¸æ“šæ¨¡å‹

### Inventory å¯¦é«”

```sql
CREATE TABLE inventory (
    id BIGSERIAL PRIMARY KEY,
    product_id BIGINT NOT NULL UNIQUE,
    quantity INTEGER NOT NULL DEFAULT 0 CHECK (quantity >= 0),
    reserved_quantity INTEGER NOT NULL DEFAULT 0 CHECK (reserved_quantity >= 0),
    version INTEGER NOT NULL DEFAULT 0,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    CONSTRAINT chk_available_quantity CHECK (quantity >= reserved_quantity)
);
```

### æ ¸å¿ƒæ¥­å‹™æ–¹æ³•

- `getAvailableQuantity()` - è¨ˆç®—å¯ç”¨åº«å­˜
- `hasAvailableStock(quantity)` - æª¢æŸ¥åº«å­˜æ˜¯å¦å……è¶³
- `reserveStock(quantity)` - é ç•™æŒ‡å®šæ•¸é‡
- `releaseReservedStock(quantity)` - é‡‹æ”¾é ç•™åº«å­˜
- `confirmReservedStock(quantity)` - ç¢ºèªä¸¦æ‰£æ¸›åº«å­˜

## ğŸ”§ é…ç½®ç®¡ç†

### ç’°å¢ƒé…ç½®

- **é–‹ç™¼ç’°å¢ƒ**: `application-dev.yml`
- **æ¸¬è©¦ç’°å¢ƒ**: `application-test.yml`
- **ç”Ÿç”¢ç’°å¢ƒ**: é€šé Config Server ç®¡ç†

### é—œéµé…ç½®

```yaml
# Redis åˆ†æ•£å¼é–é…ç½®
spring:
  data:
    redis:
      host: localhost
      port: 6379
      database: 2

# æ•¸æ“šåº«é€£æ¥æ± 
  datasource:
    hikari:
      maximum-pool-size: 15
      minimum-idle: 5
      connection-timeout: 20000
```

## ğŸ³ å®¹å™¨åŒ–éƒ¨ç½²

### Docker é…ç½®

- **å¤šéšæ®µæ§‹å»º**: å„ªåŒ–é¡åƒå¤§å°
- **å¥åº·æª¢æŸ¥**: è‡ªå‹•æª¢æ¸¬æœå‹™ç‹€æ…‹
- **ç’°å¢ƒè®Šé‡**: éˆæ´»é…ç½®ä¸åŒç’°å¢ƒ

### Docker Compose é›†æˆ

- èˆ‡ PostgreSQLã€Redisã€Eureka ç­‰æœå‹™çš„å®Œæ•´é›†æˆ
- æœå‹™ä¾è³´ç®¡ç†
- ç¶²çµ¡éš”é›¢å’Œé€šä¿¡

## ğŸ“ˆ æ€§èƒ½æŒ‡æ¨™

### åŸºæº–æ¸¬è©¦çµæœ

- **å–®æ¬¡æŸ¥è©¢**: < 50ms
- **åº«å­˜é ç•™**: < 100ms
- **ä½µç™¼è™•ç†**: 100+ TPS
- **ç³»çµ±éŸ¿æ‡‰**: 99.9% < 200ms

### ç³»çµ±å®¹é‡

- **æ•¸æ“šåº«é€£æ¥æ± **: 15å€‹é€£æ¥
- **Redis é€£æ¥**: 8å€‹æ´»èºé€£æ¥
- **JVM å †å…§å­˜**: 512MB-1GB
- **ä½µç™¼è™•ç†èƒ½åŠ›**: 100+ è«‹æ±‚/ç§’

## ğŸ” ç›£æ§èˆ‡è§€æ¸¬

### å¥åº·æª¢æŸ¥

- **Spring Boot Actuator**: `/actuator/health`
- **è‡ªå®šç¾©å¥åº·æª¢æŸ¥**: æ•¸æ“šåº«é€£æ¥ã€Redis é€£æ¥
- **Prometheus æŒ‡æ¨™**: æ¥­å‹™æŒ‡æ¨™æ”¶é›†

### æ—¥èªŒç­–ç•¥

- **çµæ§‹åŒ–æ—¥èªŒ**: JSON æ ¼å¼
- **é—œéµæ“ä½œæ—¥èªŒ**: åº«å­˜è®Šæ›´è¿½è¹¤
- **éŒ¯èª¤ç›£æ§**: ç•°å¸¸æƒ…æ³å‘Šè­¦

## ğŸ§° æ¸¬è©¦å·¥å…·

### æ¸¬è©¦è…³æœ¬

1. **åŸºæœ¬åŠŸèƒ½æ¸¬è©¦**: `test-inventory-service.sh`
2. **ä½µç™¼å£“åŠ›æ¸¬è©¦**: `test-inventory-concurrency.sh`
3. **è² è¼‰æ€§èƒ½æ¸¬è©¦**: `test-inventory-load.sh`

### æ¸¬è©¦è¦†è“‹ç‡

- **å–®å…ƒæ¸¬è©¦**: 85%+ ä»£ç¢¼è¦†è“‹ç‡
- **é›†æˆæ¸¬è©¦**: ä¸»è¦ API æµç¨‹è¦†è“‹
- **ä½µç™¼æ¸¬è©¦**: é—œéµæ¥­å‹™å ´æ™¯é©—è­‰

## ğŸš¦ éƒ¨ç½²å°±ç·’æª¢æŸ¥æ¸…å–®

- [x] ä»£ç¢¼å¯¦ç¾å®Œæˆ
- [x] å–®å…ƒæ¸¬è©¦é€šé
- [x] é›†æˆæ¸¬è©¦é€šé
- [x] ä½µç™¼æ¸¬è©¦é€šé
- [x] é˜²è¶…è³£æ©Ÿåˆ¶é©—è­‰
- [x] Docker é¡åƒæ§‹å»º
- [x] é…ç½®æ–‡ä»¶å®Œæ•´
- [x] æ•¸æ“šåº«é·ç§»è…³æœ¬
- [x] å¥åº·æª¢æŸ¥é…ç½®
- [x] ç›£æ§æŒ‡æ¨™é…ç½®
- [x] æ–‡æª”å®Œæ•´

## ğŸ¯ ä¸‹ä¸€æ­¥è¨ˆåŠƒ

é›–ç„¶æ ¸å¿ƒåŠŸèƒ½å·²å®Œæˆï¼Œä½†å¯ä»¥è€ƒæ…®ä»¥ä¸‹å¢å¼·ï¼š

1. **æ€§èƒ½å„ªåŒ–**
   - æŸ¥è©¢çµæœç·©å­˜
   - æ‰¹é‡æ“ä½œå„ªåŒ–
   - æ•¸æ“šåº«ç´¢å¼•èª¿å„ª

2. **åŠŸèƒ½å¢å¼·**
   - åº«å­˜è®Šæ›´æ­·å²è¨˜éŒ„
   - åº«å­˜å‘Šè­¦æ©Ÿåˆ¶
   - è‡ªå‹•è£œè²¨å»ºè­°

3. **é‹ç¶­å¢å¼·**
   - è‡ªå®šç¾© Metrics
   - åˆ†æ•£å¼è¿½è¹¤
   - è‡ªå‹•åŒ–éƒ¨ç½²æµæ°´ç·š

## ğŸ† ç¸½çµ

**Inventory Service** å·²æˆåŠŸå¯¦ç¾äº†ä¸€å€‹å®Œæ•´ã€å¯é ã€é«˜æ€§èƒ½çš„åº«å­˜ç®¡ç†å¾®æœå‹™ï¼Œå…·å‚™ä»¥ä¸‹æ ¸å¿ƒå„ªå‹¢ï¼š

- âœ… **é«˜å¯é æ€§**: å¤šå±¤é˜²è¶…è³£æ©Ÿåˆ¶ï¼Œç¢ºä¿æ•¸æ“šä¸€è‡´æ€§
- âœ… **é«˜æ€§èƒ½**: åˆ†æ•£å¼é–+æ¨‚è§€é–ï¼Œæ”¯æŒé«˜ä½µç™¼å ´æ™¯
- âœ… **æ˜“æ“´å±•**: å¾®æœå‹™æ¶æ§‹ï¼Œæ”¯æŒæ°´å¹³æ“´å±•
- âœ… **æ˜“ç¶­è­·**: å®Œæ•´çš„æ¸¬è©¦è¦†è“‹å’Œæ–‡æª”
- âœ… **ç”Ÿç”¢å°±ç·’**: å®¹å™¨åŒ–éƒ¨ç½²ï¼Œç›£æ§å‘Šè­¦å®Œå‚™

è©²æœå‹™å·²æº–å‚™å¥½åœ¨ç”Ÿç”¢ç’°å¢ƒä¸­æä¾›ç©©å®šå¯é çš„åº«å­˜ç®¡ç†åŠŸèƒ½ï¼ ğŸš€
